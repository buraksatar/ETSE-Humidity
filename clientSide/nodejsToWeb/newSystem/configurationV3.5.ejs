<!-- views/pages/configuration.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../partials/head %>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>


<meta charset='UTF-8'> 
<meta name='viewport' content='width=device-width', initial-scale=1.0></head>


<body class="container", onload= >
    
    <header>
        <% include ../partials/header %>
    </header>

	You have <div id="numberOfSensor"></div>sensor in your network
	
	<br><br>
    Latest update time in UNIX time mode:
	<p id="latestUpdateTimeUnix"></p>

    <br>
	ChipID numbers of all  :
	<p id="allCHipIDNumbers"></p>



    <form action="configuration" method="get">
        <input type="text" name="number"/>
        <input type="text" name="queue"/>
        <input type="submit" value='Add a New Client to The Server' />
    </form>
    <form action="configuration" method="get">
        <input type="text" name="numberForDelete"/>
        <input type="text" name="queueForDelete"/>
        <input type="submit" value='Delete a Client from The Server' />
    </form>
    <form action="configuration" method="get">
    <select id="dynamicSensorList" =></select>
    </form>

<script>
    

 

    var tagDatas = {
	    chipIDnumber : [],
        chipIDqueue : [],
        chipIDunixTime : [],
        chipIDid : [],
        sensorLength : 0,
        sensorList : []
    };
 
    <%for(var i=0;i < tagId.length; i++){ %> 
        tagDatas.chipIDid.push(<%= tagId[i] %>);
        tagDatas.chipIDunixTime.push(<%= tagUnixTime[i] %>);
        tagDatas.chipIDnumber.push(<%= tagNumber[i] %>);
	<% } %>

    document.getElementById("numberOfSensor").innerHTML = tagDatas.chipIDid.length;
    document.getElementById("latestUpdateTimeUnix").innerHTML = tagDatas.chipIDunixTime.slice(-1);
    document.getElementById("allCHipIDNumbers").innerHTML = tagDatas.chipIDnumber;

    var select = document.getElementById("dynamicSensorList");
    select.options[0] = new Option('Select a Sensor', 'sensor0');

    //select = document.getElementById("dynamicSensorList");
    for(index in tagDatas.chipIDnumber) {
        select.options[select.options.length] = new Option(tagDatas.chipIDnumber[index], 'sensor'+ (parseInt(index)+1) );
    }
    tagDatas.sensorLength = select.options.length;

    //console.log(select.options[select.selectedIndex].value);
    if(select.options[select.selectedIndex].value == 1)
                {
                    console.log('sus bee');
                }


    console.log(tagDatas.sensorLength);

    /// ajax request
    var interval2 = null;
    interval2 = setInterval(ajaxCall,3000);

    tagDatas.sensorLength--;

    console.log(tagDatas.sensorLength);
    function ajaxCall() {
	
	    $.ajax({
        	url: "/getBuff",
        	type: "POST",
        	dataType: "json",
        	data: {},
        	contentType: "application/json",
        	cache: false,
        	timeout: 3000,
        	complete: function() {
           		//called when complete
            	console.log('process complete');
        	},
        	success: function(data) {
                tagDatas.chipIDid = data.tagId.length;
                document.getElementById("numberOfSensor").innerHTML = tagDatas.chipIDid;

                tagDatas.chipIDunixTime = data.tagUnixTime.slice(-1);
                document.getElementById("latestUpdateTimeUnix").innerHTML = tagDatas.chipIDunixTime;

                tagDatas.chipIDnumber = data.tagNumber;
                document.getElementById("allCHipIDNumbers").innerHTML = tagDatas.chipIDnumber;
                //console.log(tagDatas.sensorLength);
                console.log(tagDatas.chipIDnumber.length);
                if ( tagDatas.chipIDnumber.length != tagDatas.sensorLength)
                {
                    select.options.length = 0;
                    console.log('esit degil');
                    select.options[0] = new Option('Select a Sensor', 'sensor0');
                    
                    for(index in tagDatas.chipIDnumber) {
                        select.options[select.options.length] = new Option(tagDatas.chipIDnumber[index], 'sensor'+ (parseInt(index)+1) );
                    }
                    tagDatas.sensorLength = tagDatas.chipIDnumber.length;
                }

                tagDatas.sensorList = select.options[select.selectedIndex].value;
                console.log(select.options[select.selectedIndex].value);
                
                if(select.options[select.selectedIndex].value == 'sensor0')
                {
                    console.log('not selected');
                    //window.location.href = '/pageofSensor0'
                }
                if(select.options[select.selectedIndex].value == 'sensor1')
                {
                    console.log('page1');
                    //window.location.href = '/pageofSensor1'
                }
                if(select.options[select.selectedIndex].value == 'sensor2')
                {
                    console.log('page2');
                    //window.location.href = '/pageofSensor2'
                }
                if(select.options[select.selectedIndex].value == 'sensor3')
                {
                    console.log('page3');
                    //window.location.href = '/pageofSensor3'
                }
                if(select.options[select.selectedIndex].value == 'sensor4')
                {
                    console.log('page4');
                    //window.location.href = '/pageofSensor4'
                }
                //window.alert("\nValue: " + select.options[select.selectedIndex].value);

                
  	    	},
        	error: function() {
               		console.log('process error');
        	},
	    });
    }





</script>


    <footer>
        <% include ../partials/footer %>
    </footer>

</body>
</html>
